## 서버통신  com.eomcs.net.ex02

```java
// 포트번호
// => 0 ~ 1023 (well-known port)
// - 특정 프로그램이 관습적으로 사용하는 포트 번호
// - 프로그램을 작성할 때 가능한 이 포트 번호를 사용하지 말아야 한다.
// - 7(echo), 20(FTP 데이터 포트), 21(FTP 제어포트), 23(telnet),
// 25(SMTP), 53(DNS), 80(HTTP), 110(POP3), 143(IMAP) 등
// => 1024 ~ 49151 (registered port)
// - 일반적인 통신 프로그램을 작성할 때 이 범위 포트 번호를 사용한다.
// - 다만 이 범위에 번호 중에서 특정 프로그램이 널리 사용하는 번호가 있다.
// 가능한 그 번호도 피하라!
// - 8080(proxy), 1521(Oracle), 3306(MySQL) 등
// => 49152 ~ 65535 (dynamic port)
// - 통신을 하는 프로그램은 반드시 포트번호를 가져야 한다.
// 그래야 OS가 해당 프로그램을 구분할 수 있다.
// - 따라서 클라이언트 프로그램도 포트번호를 갖는데,
// 프로그램에서 결정하는 것이 아니라, OS로부터 자동 발급 받는다.
// - 이 범위의 포트번호는 클라이언트가 OS로부터 자동 발급 받는 포트 번호이다.
```



```java
Connection refused: connect // 예외:소켓을 못찾을때 
```



대기열 설정하기

```java
//server

1)서버소켓 생성
ServerSocket ss = new ServerSocket(포트번호, 대기열크기);

 // 대기열?
    // => 클라이언트가 접속을 요청하면 대기열에 클라이언트 정보를 저장한다.
    // => 저장은 큐(FIFO) 방식으로 관리한다.
    // => 대기열의 크기가 클라이언트의 연결을 허락하는 최대 개수이다.
    // => 대기열을 초과하여 클라이언트 요청을 들어 왔을 때 서버는 응답하지 않는다.
    // 클라이언트는 내부에 설정된 시간(timeout)동안 기다리다 응답을 받지 못하면
    // 예외를 던지고 연결 요청을 취소한다.
    // => new ServerSocket(포트번호, 대기열크기);
```



타임아웃 설정하기

```java
//client
1)소켓 생성
    Socket socket = new Socket();
2)소켓 어드레스 생성
    SocketAddress socketAddress = new InetSocketAddress("ip주소",포트번호);
3)커넥트
    socket.connect(socketAddress,타임아웃시간)  //타임아웃시간은 millsec
```



클라이언트와 연결

```java
//server

Socket socket = ss.accept();

// 큐(queue)에 대기중인 클라이언트 중 첫 번째 클라이언트를 꺼내서 연결을 승인한다. 
// => 클라이언트가 서버에 연결을 요청하면, 서버는 대기열에 추가한다.
// => 서버소켓에서 연결을 승인하면 클라이언트와 통신할 수 있는 소켓을 리턴한다.
// => 대기열에 기다리고 있는 클라이언트가 없으면 접속할 때까지 기다린다.
```



